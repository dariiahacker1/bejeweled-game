<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Bejeweled Game</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
</head>
<body class="bejeweled">

<div class="left-part">
    <img th:src="@{/images/logo.png}" th:alt="BEJEWELED" class="logo">
    <div class="score-board">
        <img th:src="@{/images/score.png}"
             th:alt="'score board'" class="board"/>
        <div class="score-counter">
            <p id="score-display" th:text="${playerScore}">300</p>
        </div>
    </div>
    <div class="timer-board">
        <img th:src="@{/images/timer.png}"
             th:alt="'timer board'" class="board">
        <div class="timer-counter">
            <p id="timer-display" th:text="${timeRemaining}">300</p>
        </div>
    </div>
    <div class="controls">
        <a href="/bejeweled?command=stop" class="stop-game-button">Stop Game</a>
    </div>
</div>

<div class="right-part">
    <table class="game-board">
        <tbody>
        <tr th:each="row, rowStat : ${gameField.grid}">
            <td th:each="jewel, colStat : ${row}" class="jewel-cell">
                <a href="javascript:void(0);" th:onclick="|selectJewel(${rowStat.index}, ${colStat.index})|">
                    <img th:src="@{/images/tuke_logo_{jewelType}.svg.png(jewelType=${#strings.toLowerCase(jewel.type)})}"
                         th:alt="${jewel.type}"/>
                </a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    let selectedRow = null;
    let selectedColumn = null;

    function selectJewel(row, column) {
        if (selectedRow === null && selectedColumn === null) {
            // First click
            selectedRow = row;
            selectedColumn = column;
        } else {
            // Second click â†’ trigger a swap
            window.location.href = `/bejeweled?command=swap&row=${selectedRow}&column=${selectedColumn}&newRow=${row}&newColumn=${column}`;
            selectedRow = null;
            selectedColumn = null;
        }
    }

    function updateTimer() {
        fetch("/bejeweled/time")
            .then(res => res.text())
            .then(time => {
                document.getElementById("timer-display").innerText = time;
            });
    }

    setInterval(updateTimer, 1000);
</script>

</body>
</html>